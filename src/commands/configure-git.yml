# How to author commands: https://circleci.com/docs/2.0/reusing-config/#authoring-reusable-commands
description: >
  Configure Git to allow pushing the version change and tags back to GitHub.
steps:
  - run:
      name: Configure GIT with host fingerprint, user info and SSH key for pushing
      command: |
        mkdir -p ~/.ssh
        echo "Adding github.com as known host..."
        echo $GITHUB_FINGERPRINT >> ~/.ssh/known_hosts
        echo "Setting private SSH key for pushing new version to repo..."
        echo $GITHUB_COMMIT_KEY | base64 --decode >> ~/.ssh/id_rsa
        echo "Setting permissions to avoid errors."
        chmod 400 ~/.ssh/id_rsa # prevents "UNPROTECTED PRIVATE KEY FILE" error
        chmod 755 ./.circleci/gpg-ci
        git config user.name $GITHUB_USER_NAME
        git config user.email $GITHUB_USER_EMAIL
        git config gpg.program "./.circleci/gpg-ci"
        git config user.signingkey $GPG_SIGNING_KEY
